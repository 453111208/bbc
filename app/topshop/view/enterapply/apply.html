<section class="content">
  <form action="<{url action=topshop_ctl_enterapply@saveApply}>" method="post" class="form-horizontal" role="form" data-validate-onsuccess="ajaxSubmit">
    <input type="hidden" name="enterapply_id" value="<{$applydata.enterapply_id}>">
    <fieldset>
      <div class="panel panel-outter">
        <div class="panel-body">
          <div class="col-md-10">
            <div>
              <legend id="license">基本信息</legend>
            </div>
            <div class="form-group">
              <label for="company_name" class="control-label col-md-3"><span class="text-red">*</span>公司名称：</label>
              <div class="col-md-5">
                <input type="text" name="company_name" value="<{$applydata.company_name}>" id="company_name" class="form-control" placeholder="公司名称" maxlength="50" required>
              </div>
            </div>
            <div class="form-group">
              <label for="company_area" class="control-label col-md-3"><span class="text-red">*</span>所在地区：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[company_area]" value="<{$shop_info.company_area}>" id="company_area" class="form-control" placeholder="公司所在地" required>
              </div>
            </div>
            <div class="form-group">
              <label for="company_addr" class="control-label col-md-3"><span class="text-red">*</span>详细地址：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[company_addr]" value="<{$shop_info.company_addr}>" id="company_addr" class="form-control" placeholder="公司详细地址" maxlength="50" required>
              </div>
            </div>

            <div class="form-group">
              <label for="establish_date" class="control-label col-md-3"><span class="text-red">*</span>成立日期：</label>
              <span class="form-act input-group date col-md-2" data-provide="datepicker">
                <input class="form-control" type="date" name="shop_info[establish_date]" value="<{$shop_info.establish_date|date_format:'%Y-%m-%d'}>" required placeholder="如2014-12-31">
                <span class="input-group-addon"><i class="icon icon-calendar"></i></span>
              </span>

            </div>
            <div class="form-group">
              <label for="representative" class="control-label col-md-3"><span class="text-red">*</span>法人姓名：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[representative]" value="<{$shop_info.representative}>" id="representative" class="form-control" placeholder="公司法定代表人姓名" maxlength="20" required>
              </div>
            </div>
            <div class="form-group">
              <label for="corporate_identity" class="control-label col-md-3"><span class="text-red">*</span>身份证号：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[corporate_identity]" value="<{$shop_info.corporate_identity}>" id="corporate_identity" class="form-control" placeholder="法人身份证号" maxlength="18" required >
              </div>
            </div>
            <div class="form-group">
              <label for="license_num" class="control-label col-md-3"><span class="text-red">*</span>营业执照号码：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[license_num]" value="<{$shop_info.license_num}>" id="license_num" class="form-control" placeholder="营业执照注册号" maxlength="50" required>
              </div>
            </div>
            <div class="form-group">
              <label for="license_area" class="control-label col-md-3"><span class="text-red">*</span>营业执照地区：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[license_area]" value="<{$shop_info.license_area}>" id="license_area" class="form-control" placeholder="营业执照所在地" required>
              </div>
            </div>
            <div class="form-group">
              <label for="license_addr" class="control-label col-md-3"><span class="text-red">*</span>营业执照地址：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[license_addr]" value="<{$shop_info.license_addr}>" id="license_addr" class="form-control" placeholder="营业执照详细地址" maxlength="200" required>
              </div>
            </div>
            <div class="form-group">
              <label for="license_indate" class="control-label col-md-3"><span class="text-red">*</span>营业期限：</label>
              <span class="form-act input-group date col-md-2" data-provide="datepicker">
                <input class="form-control" type="date" name="shop_info[license_indate]" value="<{$shop_info.license_indate|date_format:'%Y-%m-%d'}>" required placeholder="如2014-12-31">
                <span class="input-group-addon"><i class="icon icon-calendar"></i></span>
              </span>

            </div>
            <div class="form-group">
              <label for="tissue_code" class="control-label col-md-3"><span class="text-red">*</span>组织机构代码：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[tissue_code]" value="<{$shop_info.tissue_code}>" id="tissue_code" class="form-control" placeholder="组织机构代码" maxlength="50" required>
              </div>
            </div>
            <div class="form-group">
              <label for="scope" class="control-label col-md-3"><span class="text-red">*</span>经营范围：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[scope]" value="<{$shop_info.scope}>" id="scope" class="form-control" placeholder="经营范围" maxlength="200" required>
              </div>
            </div>
            <div class="form-group">
              <label for="enroll_capital" class="control-label col-md-3"><span class="text-red">*</span>注册资本：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[enroll_capital]" value="<{$shop_info.enroll_capital}>" id="enroll_capital" class="form-control" placeholder="注册资本" maxlength="20" required>
              </div>
            </div>
            <div class="form-group">
              <label for="company_url" class="control-label col-md-3">公司官网：</label>
              <div class="col-md-5">
                <input type="url" name="shop_info[company_url]" value="<{$shop_info.company_url}>" id="company_url" class="form-control" placeholder="公司官网，http://..." maxlength="50">
              </div>
            </div>
            <div>
              <legend id="license">联系人信息</legend>
            </div>
            <div class="form-group">
              <label for="company_contacts" class="control-label col-md-3"><span class="text-red">*</span>公司联系人：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[company_contacts]" value="<{$shop_info.company_contacts}>" id="company_contacts" class="form-control" placeholder="公司联系人" maxlength="20" required>
              </div>
            </div>
            <div class="form-group">
              <label for="company_cmobile" class="control-label col-md-3"><span class="text-red">*</span>联系人手机：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[company_cmobile]" value="<{$shop_info.company_cmobile}>" id="company_cmobile" class="form-control" placeholder="公司联系人手机" maxlength="11" required data-validate-mobile>
              </div>
            </div>
            <div class="form-group">
              <label for="company_phone" class="control-label col-md-3"><span class="text-red">*</span>联系人电话：</label>
              <div class="col-md-5">
                <input type="tel" name="shop_info[company_phone]" value="<{$shop_info.company_phone}>" id="company_phone" class="form-control" placeholder="公司电话" maxlength="20" required>
              </div>
            </div>
            <div>
              <legend id="shop">资料上传</legend>
            </div>

            <div class="form-group">
              <label for="corporate_identity_img" class="control-label col-md-3"><span class="text-red">*</span>法人身份证正反面复印件：</label>
              <div class="col-md-5">
                <div class="choose-image">
                  <input type="file" class="hide action-file-input" data-size="204800" name="shop_info[corporate_identity_img]" data-remote="<{url action=toputil_ctl_image@uploadImages from=shop}>" accept="image/*" required/>
                  <span class="image-box action-upload">
                    <img src="<{$shop_info.corporate_identity_img|storager:s}>" />
                    <input type="hidden" name="shop_info[corporate_identity_img]" value="<{$shop_info.corporate_identity_img}>">
                  </span><b class="choose-handle action-upload" title="选择图片">
                    <i class="icon-arrow-right-b"></i>
                  </b>
                  <span class="text-red">法人身份证正反面复印件不能大于200kb</span>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="license_img" class="control-label col-md-3"><span class="text-red">*</span>营业执照副本复印件：</label>
              <div class="col-md-5">
                <div class="choose-image">
                  <input type="file" class="hide action-file-input" data-size="512000" name="shop_info[license_img]" data-remote="<{url action=toputil_ctl_image@uploadImages from=shop}>" accept="image/*" required />
                  <span class="image-box action-upload">
                    <img src="<{$shop_info.license_img|storager:s}>" />
                    <input type="hidden" name="shop_info[license_img]" value="<{$shop_info.license_img}>">
                  </span><b class="choose-handle action-upload" title="选择图片">
                    <i class="icon-arrow-right-b"></i>
                  </b>
                  <span class="text-red">营业执照副本复印件不能大于500kb</span>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="tissue_code_img" class="control-label col-md-3"><span class="text-red">*</span>组织机构代码证复印件：</label>
              <div class="col-md-5">
                <div class="choose-image">
                  <input type="file" class="hide action-file-input" data-size="512000" name="shop_info[tissue_code_img]" data-remote="<{url action=toputil_ctl_image@uploadImages from=shop}>" accept="image/*" required/>
                  <span class="image-box action-upload">
                    <img src="<{$shop_info.tissue_code_img|storager:s}>" />
                    <input type="hidden" name="shop_info[tissue_code_img]" value="<{$shop_info.tissue_code_img}>">
                    </span><b class="choose-handle action-upload" title="选择图片">
                    <i class="icon-arrow-right-b"></i>
                  </b>
                  <span class="text-red">营业执照副本复印件不能大于500kb</span>
                </div>
              </div>
            </div>
            <div>
              <legend id="tax">税务登记证</legend>
            </div>
            <div class="form-group">
              <label for="tax_code" class="control-label col-md-3"><span class="text-red">*</span>税务登记证号：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[tax_code]" value="<{$shop_info.tax_code}>" id="tax_code" class="form-control" placeholder="税务登记证号" maxlength="20" required>
              </div>
            </div>
            <div class="form-group">
              <label for="tax_code_img" class="control-label col-md-3"><span class="text-red">*</span>税务登记证复印件：</label>
              <div class="col-md-5">
                <div class="choose-image">
                  <input type="file" class="hide action-file-input" data-size="512000" name="shop_info[tax_code_img]" data-remote="<{url action=toputil_ctl_image@uploadImages from=shop}>" accept="image/*" required>
                  <span class="image-box action-upload">
                    <img src="<{$shop_info.tax_code_img|storager:s}>" />
                    <input type="hidden" name="shop_info[tax_code_img]" value="<{$shop_info.tax_code_img}>">
                    </span><b class="choose-handle action-upload" title="选择图片">
                    <i class="icon-arrow-right-b"></i>
                  </b>
                  <span class="text-red">税务登记证复印件不能大于500kb</span>
                </div>
              </div>
            </div>
            <div>
              <legend id="bank">结算账号</legend>
            </div>
            <div class="form-group">
              <label for="bank_user_name" class="control-label col-md-3"><span class="text-red">*</span>银行开户公司名：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[bank_user_name]" value="<{$shop_info.bank_user_name}>" id="bank_user_name" class="form-control" placeholder="开户银行" maxlength="50" required>
              </div>
            </div>
            <div class="form-group">
              <label for="bankID" class="control-label col-md-3"><span class="text-red">*</span>银行开户账号：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[bankID]" value="<{$shop_info.bankID}>" id="bankID" class="form-control" placeholder="账号" maxlength="50" required>
              </div>
            </div>
            <div class="form-group">
              <label for="cnaps_code" class="control-label col-md-3"><span class="text-red">*</span>CNAPS CODE：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[cnaps_code]" value="<{$shop_info.cnaps_code}>" id="cnaps_code" class="form-control" placeholder="支行联行号" maxlength="50" required>
              </div>
            </div>
            <div class="form-group">
              <label for="bank_area" class="control-label col-md-3"><span class="text-red">*</span>开户银行所在地：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[bank_area]" value="<{$shop_info.bank_area}>" id="bank_area" class="form-control" placeholder="开户银行所在地" required>
              </div>
            </div>
            <div class="form-group">
              <label for="bank_name" class="control-label col-md-3"><span class="text-red">*</span>开户银行：</label>
              <div class="col-md-5">
                <input type="text" name="shop_info[bank_name]" value="<{$shop_info.bank_name}>" id="bank_name" class="form-control" placeholder="支行名称" maxlength="50" required>
              </div>
            </div>
            <div>
              <legend id="shop">店铺信息</legend>
            </div>
            <div class="form-group">
              <label for="shop_type" class="control-label col-md-3"><span class="text-red">*</span>店铺类型：</label>
              <div class="col-md-5">
                <select name="shop_type" id="shop_type" class="form-control">
                  <option value="">请先选择店铺类型</option>
                  <{foreach from=$shoptypelist item=shoptype key=key}>
                  <option value="<{$shoptype.shop_type}>" <{if $shoptype.shop_type == $applydata.shop_type}>selected<{/if}>><{$shoptype.name}> (后缀名为<{$shoptype.suffix}>)</option>
                  <{/foreach}>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="shop_cart" class="control-label col-md-3"><span class="text-red">*</span>店铺经营类目：</label>
              <div class="col-md-5">
                <select name="shop[shop_cat]" id="shop_cat" class="form-control" autocomplete="off">
                  <option value="">请先选择经营类目</option>
                  <{foreach from=$catlist item=catname key=key}>
                  <option  value="<{$key}>" <{if $shop.shop_cat == $key}>selected <{/if}>><{$catname}></option>>
                  <{/foreach}>
                </select>
              </div>
            </div>
            <div class="form-group brand-type" style="display:none;">
              <label for="shop_brand" class="control-label col-md-3">经营品牌：</label>
              <div class="col-md-5">
                <div class="col-xs-6">
                  <select name="shop[shop_brand]" id="shop_brand" class="form-control" autocomplete="off">

                  </select>
                </div>
                <div class="col-xs-1">
                  <p class="form-control-static" id="">或</p>
                </div>
                <div class="col-xs-5">
                  <input type="text" name="new_brand" value="<{$applydata.new_brand}>" id="new_brand" maxlength="50" class="form-control form-control-static" placeholder="新增品牌" autocomplete="off">
                </div>
              </div>
            </div>
            <div class="form-group brand-type" style="display:none;">
              <label for="brand_warranty" class="control-label col-md-3"><span class="text-red">*</span>品牌授权书电子版：</label>
              <div class="col-md-5">
                <div class="choose-image">
                  <input type="file" class="hide action-file-input" data-size="512000" name="shop_info[brand_warranty]" data-remote="<{url action=toputil_ctl_image@uploadImages from=shop}>" accept="image/*" />
                  <span class="image-box action-upload">
                    <img src="<{$shop_info.brand_warranty|storager:s}>" />
                    <input type="hidden" name="shop_info[brand_warranty]" value="<{$shop_info.brand_warranty}>">
                    </span><b class="choose-handle action-upload" title="选择图片">
                    <i class="icon-arrow-right-b"></i>
                  </b>
                  <span class="text-red">品牌授权书电子版不能大于500kb</span>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="shop_name" class="control-label col-md-3"><span class="text-red">*</span>店铺名称：</label>
              <div class="col-md-5">
                <input type="text" name="shop_name" value="<{$applydata.shop_name}>" id="shop_name" class="form-control" placeholder="店铺名称" maxlength="20" required>
              </div>
            </div>
            <div class="form-group">
              <label for="shop_name" class="control-label col-md-3"><span class="text-red">*</span>店铺描述：</label>
              <div class="col-md-5">
                <textarea name="shop[shop_descript]" class="form-control" maxlength="500"><{$shop.shop_descript}></textarea>
              </div>
            </div>
            <div class="form-group">
              <label for="shopuser_name" class="control-label col-md-3"><span class="text-red">*</span>店主姓名：</label>
              <div class="col-md-5">
                <input type="text" name="shopuser_name" value="<{$applydata.shopuser_name}>" id="shopuser_name" class="form-control" placeholder="店主姓名" maxlength="20" required>
              </div>
            </div>
            <div class="form-group">
              <label for="" class="control-label col-md-3"><span class="text-red">*</span>店主身份证号：</label>
              <div class="col-md-5">
                <input type="text" name="shop[shopuser_identity]" value="<{$shop.shopuser_identity}>" id="shopuser_identity" class="form-control" placeholder="店主身份证号" maxlength="18" required >
              </div>
            </div>
            <div class="form-group">
              <label for="shopuser_identity_img" class="control-label col-md-3"><span class="text-red">*</span>店主身份证电子版：</label>
              <div class="col-md-5">
                <div class="choose-image">
                  <input type="file" class="hide action-file-input" data-size="204800" name="shop_info[shopuser_identity_img]" data-remote="<{url action=toputil_ctl_image@uploadImages from=shop}>" accept="image/*" required/>
                  <span class="image-box action-upload">
                    <img src="<{$shop_info.shopuser_identity_img|storager:s}>" />
                    <input type="hidden" name="shop_info[shopuser_identity_img]" value="<{$shop_info.shopuser_identity_img}>">
                  </span><b class="choose-handle action-upload" title="选择图片">
                    <i class="icon-arrow-right-b"></i>
                  </b>
                  <span class="text-red">店主身份证电子版不能大于200kb</span>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="shop_area" class="control-label col-md-3"><span class="text-red">*</span>所在地区：</label>
              <div class="col-md-5">
                <input type="text" name="shop[shop_area]" value="<{$shop.shop_area}>" id="shop_area" class="form-control" placeholder="所在地区" required>
              </div>
            </div>
            <div class="form-group">
              <label for="shop_addr" class="control-label col-md-3"><span class="text-red">*</span>详细地址：</label>
              <div class="col-md-5">
                <input type="text" name="shop[shop_addr]" value="<{$shop.shop_addr}>" id="shop_addr" class="form-control" placeholder="详细地址" maxlength="50" required>
              </div>
            </div>
            <div class="form-group">
              <label for="mobile" class="control-label col-md-3"><span class="text-red">*</span>手机号码：</label>
              <div class="col-md-5">
                <input type="text" name="shop[mobile]" value="<{$shop.mobile}>" id="mobile" class="form-control" placeholder="手机号码" maxlength="11" required data-validate-mobile>
              </div>
            </div>
            <div class="form-group">
              <label for="email" class="control-label col-md-3"><span class="text-red">*</span>邮箱：</label>
              <div class="col-md-5">
                <input type="email" name="shop[email]" value="<{$shop.email}>" id="email" class="form-control" placeholder="邮箱" maxlength="50" required>
              </div>
            </div>


          </div>
      </div></div>
    </fieldset>

    <div class="navbar-fixed-bottom navbar-fixed-btn">
      <button type="submit" class="btn btn-primary">申请入驻</button>
    </div>
  </form>
</section>
<script>
  $('.wrapper').scrollspy({
    target: '.sidebar'
  });
//$('#sidebar_nav').css('left', $('#login_box').offset().left - $('#sidebar_nav').width() + 'px');
<{if $applydata.enterapply_id == ''}>
$('form').rememberState({mark: 'enterapply'}).rememberState('restoreState');
<{/if}>

function ajaxSubmit (e) {
  var form = e.target;
  e.preventDefault();
  $.post(form.action, $(form).serialize(), function(rs) {
    if(rs.error) {
      $('#messagebox').message(rs.message);
      return;
    }
    if(rs.success) {
      $('#messagebox').message(rs.message, 'success');
    }
    if(rs.redirect) {
      location.href = rs.redirect;
    }
  });
}

$('#shop_type').on('change',function(){
  if($(this).val() == "cat"){
    $('.brand-type').hide();
  }else{
    $('.brand-type').show();
  }
}).trigger('change');

$('#shop_cat').on('change',function(){
  var shoptypeval = $('#shop_type').val();
  var url = "<{url action=topshop_ctl_enterapply@ajaxCatBrand}>";
  if($(this).val() && shoptypeval != "cat") {
    $.post(url,'cat_id='+$(this).val(),function(rs){
      var optionstring = "";
      for (var j = 0; j < rs.length; j++) {
        optionstring += '<option value="' + rs[j].brand_id + '"';
        if(rs[j].brand_id == '<{$shop.shop_brand}>') {
          optionstring += ' selected';
        }
        optionstring += '>' + rs[j].brand_name + '</option>';
      }
      $("#shop_brand").html("<option value=''>请选择...</option> "+optionstring).trigger('change');

    });
  }
}).trigger('change');

$('#shop_brand').on('change',function(){
  var shoptypeval = $('#shop_type').val();
  if(this.value !== '' || shoptypeval == "cat") {
    $('#new_brand').val('');
  }
}).trigger('change');

$('#new_brand').on('change',function(){
  var shoptypeval = $('#shop_type').val();
  if(this.value || shoptypeval == "cat") {
    $('#shop_brand').val('');
  }
})

</script>
