(function(d){var h,k,l,f=function(b,a){this.container=d(b);if(this.container.size()&&(this.options=a||{},this.url=a.url,this.select=this.container.find(this.options.select),this.selectedList=this.container.find(this.options.selectedList),this.selectedParam=this.container.find(this.options.selectedParam),this.last_search="",this.url))return this.init()};f.prototype.init=function(){this.__i=0;this.loadList(this.options.name,this.options.value);this.onload&&this.onload(this);return this.bindEvent(this.container)};
f.prototype.loadList=function(b,a){var c=this;if(this.options.data[a])return this.options.value=a,this.setItems(this.options.data[a]);d.post(this.url,b+"="+a,function(b){b.error&&d("#messagebox").message(b.message);c.options.data[a]=b.data;c.options.value=a;c.setItems(b.data);c.oncallback&&c.oncallback(c,b)});return this};f.prototype.setItems=function(b){this.list=[];var a=this.select.eq(this.__i);this.select.filter(":gt("+(this.__i-1)+")").html("");for(var c in b.options)b.options.hasOwnProperty(c)&&
(this.list[c]=this.createItem(b.options[c]),a.append(this.list[c]),b.selectedIndex==c&&this.list[c].trigger("click"));return this};f.prototype.createItem=function(b){var a=this,c=this.options.data[this.options.value],e=this.options.itemClass||"";b.hasChild&&(e+=" "+this.options.itemClass+"-haschild");e=d('<a href="'+this.url+'" rel="'+b.value+'" class="'+e+'">'+b.text+"</a>");e.on("click",function(e){e&&e.preventDefault();d(this).addClass(a.options.selectedClass).siblings("."+a.options.selectedClass).removeClass(a.options.selectedClass);
c.selectedIndex="";b.hasChild?(a.__i=d(this).parent().parent().index()+1,a.loadList(a.options.name,b.value)):a.select.filter(":gt("+d(this).parent().parent().index()+")").html("");var f=[];a.select.find("."+a.options.selectedClass).each(function(){f.push(d(this).text())});a.selectedList.html(f.join(" > "));""==a.selectedParam.attr("name")&&a.selectedParam.attr("name",a.options.name);e.isTrigger?a.selectedParam.val()||a.selectedParam.val(b.value):a.selectedParam.val(b.value);a.onchange=function(b){if("function"!==
typeof a.options.onchange)a.options.onchange=b;else{var c=a.options.onchange;a.options.onchange=function(){c();b()}}};if(a.options.onchange)a.options.onchange(a,b)});return e};f.prototype.bindEvent=function(b){var a=this;this.options.searchbox&&(this.searchbox=b.find(this.options.searchbox).on("input",function(){a.search(d(this).val(),a.select.eq(d(this).parent().parent().index()))}));return this};f.prototype.search=function(b,a){var c=this;clearTimeout(this.timeout);this.timeout=setTimeout(function(){var e=
b,e=e||"",d,f;if(e!==c.last_search){c.last_search=e;var g=a.children();for(d in g)g.hasOwnProperty(d)&&(f=c.options.match.call(c,e,g.eq(d).text()),-1!==f&&(!e||f?"none"===g.eq(d).css("display")&&g.eq(d).show():"none"!==g.eq(d).css("display")&&g.eq(d).hide()));c.select.scrollTop=0}},this.options.delay);return this};l={url:"",name:"",value:"0",data:{},match:function(b,a){h!==b&&(k=RegExp(b,"i"),h=b);return!!a.match(k)},update:null,searchbox:null,onchange:null,delay:200,subs:".sub-cat",select:".list-group-select",
itemClass:"list-group-item",selectedList:".cat-select-foot span",selectedParam:".cat-select-foot input[type=hidden]",selectedClass:"active"};d.fn.catselect=function(b){b=d.extend(!0,l,b||{});this.each(function(){d(this).data("_catselect_",new f(this,b))})}})(jQuery);